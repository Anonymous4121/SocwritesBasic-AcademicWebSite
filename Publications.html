<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Publications</title>
  <link rel="stylesheet" href="css/PublicationsPage.css" />
  <link rel="stylesheet" href="css/HomePage.css" />
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container centered-header">
      <img src="./images/logo/logo3.png" alt="SocWrites Logo" class="logo" />
      <h1>SocWrites Journal</h1>
      <hr class="header-separator" />
      <nav>
        <ul>
          <li><a href="./index.html">Home</a></li>
          <li><a href="./Publications.html" class="active">Publications</a></li>
          <li><a href="./submit.html">Submit</a></li>
          <li><a href="./About_Us.html">About Us</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Search Section -->
    <div class="search-section">
      <button id="search-toggle">üîç Search</button>
      <input type="text" id="search-bar" placeholder="Search articles..." />
    </div>

    <!-- Search Overlay -->
    <div id="search-overlay">
      <div class="search-page-inner">
        <button id="close-search-overlay" class="close-btn">&times;</button>
        <h2>Search Articles</h2>
        <input type="text" id="overlay-search-bar" placeholder="Type to search articles...">
        <div id="overlay-articles-grid" class="publications-grid"></div>
        <p id="overlay-no-results">No results found.</p>
      </div>
    </div>

    <!-- Articles Grid with Skeleton Loader -->
    <section class="publications-grid" id="publications-grid">
      <!-- Skeleton cards (12 placeholders) -->
      <article class="pub-card skeleton" style="animation: pulse 1.5s ease-in-out infinite;">
        <div style="height:150px;background:#f0f0f0;border-radius:6px;"></div>
        <div style="height:20px;background:#f0f0f0;border-radius:4px;margin:8px 0;width:80%;"></div>
        <div style="height:16px;background:#f0f0f0;border-radius:4px;width:60%;"></div>
      </article>
      <!-- Repeat 11 more times -->
      <article class="pub-card skeleton" style="animation: pulse 1.5s ease-in-out infinite;animation-delay:0.1s;">
        <div style="height:150px;background:#f0f0f0;border-radius:6px;"></div>
        <div style="height:20px;background:#f0f0f0;border-radius:4px;margin:8px 0;width:80%;"></div>
        <div style="height:16px;background:#f0f0f0;border-radius:4px;width:60%;"></div>
      </article>
      <!-- [Add 10 more skeleton cards with staggered animation-delay: 0.2s, 0.3s, etc.] -->
      <!-- For brevity, I'll show 2 above - add 10 more identical ones -->
    </section>

    <!-- Pagination -->
    <div class="pagination-nav">
      <button id="back-page-btn" style="visibility: hidden;">&larr; Back</button>
      <button id="next-page-btn" disabled>Next &rarr;</button>
    </div>
    
    <p id="no-results-msg" style="display:none;">No articles found.</p>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-column">
        <h3>SocWrites</h3>
        <p>Where Research Meets Readers.</p>
        <p>¬© 2025 SocWrites. All Rights Reserved.</p>
      </div>
      <div class="footer-column">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="Publications.html">Publications</a></li>
          <li><a href="submit.html">Submit</a></li>
          <li><a href="About_Us.html">About Us</a></li>
          <li><a href="mailto:support@socwrites.org">FAQ</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h4>Contact Us</h4>
        <p>Email: <a href="mailto:editor@socwrites.org">editor@socwrites.org</a></p>
        <p>Phone: +91 9650XXX101</p>
        <p>New Delhi, India</p>
        <div class="social-icons">
          <a href="https://www.facebook.com"><img src="images/logo/Facebook.svg" alt="Facebook" /></a>
          <a href="https://www.instagram.com/thesocwrites"><img src="images/logo/Instagram.svg" alt="Instagram" /></a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    const API_BASE = "https://glowing-star-d89f1652ea.strapiapp.com";
    const CACHE_KEY = 'strapi_articles_cache';
    const CACHE_TIME = 5 * 60 * 1000; // 5 minutes
    
    let allArticles = [], page = 0, paginatedFiltered = [];
    const ARTICLES_PER_PAGE = 12;

    // ‚ö° ULTRA FAST article card
    function createArticleCard(article) {
      const attrs = article.attributes || article;
      const id = article.id;
      const title = (attrs.Title || 'Untitled').substring(0, 60);
      const author = attrs.Author || 'Unknown';
      const date = attrs.PublishDate?.split('T')[0] || 'No date';
      const imgUrl = attrs.ArticleImage?.data?.attributes?.url 
        ? `${API_BASE}${attrs.ArticleImage.data.attributes.url}` 
        : './images/logo/DefaultImage.svg';

      const card = document.createElement('article');
      card.className = 'pub-card';
      card.dataset.id = id;
      card.innerHTML = `
        <img src="${imgUrl}" alt="${title}" loading="lazy" 
             onerror="this.src='./images/logo/DefaultImage.svg'" />
        <h3 title="${title}">${title}</h3>
        <p class="meta">By ${author} | ${date}</p>
      `;
      card.onclick = () => window.location.href = `./articlesPage.html?id=${id}`;
      return card;
    }

    // üöÄ SUPER FAST LOAD SEQUENCE
    async function loadArticles() {
      const grid = document.getElementById('publications-grid');
      
      // 1. CACHE FIRST (instant)
      const cached = localStorage.getItem(CACHE_KEY);
      const cacheTime = localStorage.getItem(`${CACHE_KEY}_time`);
      if (cached && cacheTime && Date.now() - parseInt(cacheTime) < CACHE_TIME) {
        allArticles = JSON.parse(cached);
        replaceSkeletons();
        console.log('‚ö° CACHE HIT!');
        return;
      }

      // 2. OPTIMIZED API (minimal fields)
      try {
        const res = await fetch(
          `${API_BASE}/api/articles?populate=ArticleImage&fields[0]=Title&fields[1]=Author&fields[2]=PublishDate&pagination[limit]=100`,
          { cache: 'default' }
        );
        const json = await res.json();
        allArticles = json.data || [];
        
        // Cache it
        localStorage.setItem(CACHE_KEY, JSON.stringify(allArticles));
        localStorage.setItem(`${CACHE_KEY}_time`, Date.now().toString());
        
        replaceSkeletons();
      } catch (e) {
        grid.innerHTML = '<p style="text-align:center;color:var(--taupe);">Failed to load articles</p>';
      }
    }

    function replaceSkeletons() {
      paginatedFiltered = allArticles;
      renderPage();
    }

    function renderPage() {
      const grid = document.getElementById('publications-grid');
      grid.innerHTML = '';
      
      const start = page * ARTICLES_PER_PAGE;
      const end = start + ARTICLES_PER_PAGE;
      paginatedFiltered.slice(start, end).forEach(article => {
        grid.appendChild(createArticleCard(article));
      });

      const totalPages = Math.ceil(paginatedFiltered.length / ARTICLES_PER_PAGE);
      document.getElementById('back-page-btn').style.visibility = page > 0 ? 'visible' : 'hidden';
      document.getElementById('next-page-btn').disabled = page >= totalPages - 1;
    }

    // Search overlay
    document.getElementById('search-toggle').onclick = () => {
      document.getElementById('search-overlay').style.display = 'block';
      document.getElementById('overlay-search-bar').focus();
    };

    document.getElementById('close-search-overlay').onclick = () => {
      document.getElementById('search-overlay').style.display = 'none';
    };

    document.getElementById('overlay-search-bar').oninput = (e) => {
      const query = e.target.value.toLowerCase();
      const overlayGrid = document.getElementById('overlay-articles-grid');
      const filtered = allArticles.filter(a => {
        const attrs = a.attributes || a;
        return attrs.Title?.toLowerCase().includes(query) || attrs.Author?.toLowerCase().includes(query);
      });
      
      overlayGrid.innerHTML = '';
      filtered.slice(0, 20).forEach(article => overlayGrid.appendChild(createArticleCard(article)));
    };

    // Pagination
    document.getElementById('next-page-btn').onclick = () => {
      if (page < Math.ceil(allArticles.length / ARTICLES_PER_PAGE) - 1) {
        page++; renderPage();
      }
    };
    document.getElementById('back-page-btn').onclick = () => {
      if (page > 0) { page--; renderPage(); }
    };

    // ESC to close overlay
    document.onkeydown = (e) => {
      if (e.key === 'Escape') document.getElementById('search-overlay').style.display = 'none';
    };

    window.onload = loadArticles;
  </script>
</body>
</html>
