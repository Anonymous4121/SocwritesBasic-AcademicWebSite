<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SocWrites oJournal</title>
  <link rel="stylesheet" href="./css/HomePage.css" />
</head>

<body>
  <header>
    <div class="container centered-header">
      <!-- Left Scroll -->
      <div class="scroll left-scroll">
        <div class="scroll-paper">
          <p>Loading welcome message...</p> <!-- Dynamic from Strapi -->
        </div>
      </div>

      <!-- FIXED LOGO PATH -->
      <img src="./images/logo/logo3.png" alt="SocWrites Logo" class="logo" />
      <h1>SocWrites Journal</h1>
      <p class="tagline">Where Research Meets Readers</p>
      <hr class="header-separator" />
      <nav>
        <ul>
          <li><a href="./index.html">Home</a></li>
          <li><a href="./Publications.html">Publications</a></li>
          <li><a href="./submit.html">Submit</a></li>
          <li><a href="./About_Us.html">About Us</a></li>
        </ul>
      </nav>
      
      <!-- Right Scroll -->
      <div class="scroll right-scroll">
        <div class="scroll-paper">
          <p>Loading inspirational quote...</p> <!-- Dynamic from Strapi -->
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="featured-article" id="featured-article">
      <h2>ðŸ“˜ Featured Research</h2>
      <!-- JS will inject featured articles here -->
    </section>

    <section class="article-list" id="recent-articles">
      <h2>ðŸ“° Recent Publications</h2>
      <!-- JS will inject recent articles here -->
    </section>
  </main>

  <!-- FIXED FOOTER SOCIAL ICONS -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-column">
        <h3>SocWrites</h3>
        <p>Where Research Meets Readers.</p>
        <p>Â© 2025 SocWrites. All Rights Reserved.</p>
      </div>

      <div class="footer-column">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="./index.html">Home</a></li>
          <li><a href="./Publications.html">Publications</a></li>
          <li><a href="./submit.html">Submit</a></li>
          <li><a href="./About_Us.html">About Us</a></li>
          <li><a href="mailto:support@socwrites.org">FAQ</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4>Contact Us</h4>
        <p>Email: <a href="mailto:editor@socwrites.org">editor@socwrites.org</a></p>
        <p>Phone: +91 9650XXX101</p>
        <p>New Delhi, India</p>

        <div class="social-icons">
          <!-- FIXED SOCIAL ICON PATHS -->
          <a href="https://www.facebook.com"><img src="./images/logo/Facebook.svg" alt="Facebook" /></a>
          <a href="https://www.instagram.com/thesocwrites?igsh=MjI5czdtcHlpaW5r"><img src="./images/logo/Instagram.svg" alt="Instagram" /></a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // PRODUCTION STRAPI URL
    const API_BASE = "https://glowing-star-d89f1652ea.strapiapp.com";

    async function loadArticles() {
      try {
        const res = await fetch(`${API_BASE}/api/articles?populate=*`);
        const json = await res.json();
        const articles = Array.isArray(json.data) ? json.data : [];

        const featuredSection = document.getElementById("featured-article");
        const recentSection = document.getElementById("recent-articles");

        featuredSection.innerHTML = "<h2>ðŸ“˜ Featured Research</h2>";
        recentSection.innerHTML = "<h2>ðŸ“° Recent Publications</h2>";

        if (articles.length === 0) {
          featuredSection.innerHTML += "<p>No articles found. Please add articles in Strapi admin.</p>";
          return;
        }

        // Filter featured (isFeatured: true) - limit 3
        const featuredArticles = articles.filter(article => 
          (article.attributes?.isFeatured || article.isFeatured) === true
        ).slice(0, 3);

        // Rest as recent (newest first)
        const recentArticles = articles
          .filter(article => 
            (article.attributes?.isFeatured || article.isFeatured) !== true
          )
          .sort((a, b) => new Date(b.attributes?.PublishDate || b.PublishDate) - new Date(a.attributes?.PublishDate || a.PublishDate));

        // Helper to extract text from Rich Text (JournalContent)
        const extractRichText = (richTextArray) => {
          if (!richTextArray || !Array.isArray(richTextArray)) return "No content available.";
          
          const content = richTextArray.children?.length ? richTextArray.children : richTextArray;
          
          return content
            ?.map(block => block.children?.map(child => child.text || "").join(" ") || "")
            .join(" ")
            .slice(0, 150) + "..." || "No content available.";
        };

        // FIXED Image helper for GitHub Pages + Strapi
        const getImageUrl = (article) => {
          let imgData = null;
          
          if (article.ArticleImage?.data?.attributes?.url) {
            imgData = article.ArticleImage.data.attributes;
          } else if (article.attributes?.ArticleImage?.data?.attributes?.url) {
            imgData = article.attributes.ArticleImage.data.attributes;
          }
          
          if (imgData?.url) {
            return API_BASE + imgData.url;
          }
          return "./images/logo/DefaultImage.svg";
        };

        // FEATURED ARTICLES (up to 3)
        if (featuredArticles.length > 0) {
          featuredArticles.forEach((feat) => {
            const featAttrs = feat.attributes || feat;
            const img = getImageUrl(feat);
            featuredSection.innerHTML += `
              <article>
                <img src="${img}" 
                     style="width:100%;max-height:240px;object-fit:cover;border-radius:10px;margin-bottom:10px;"
                     onerror="this.src='./images/logo/DefaultImage.svg';"
                     alt="Featured article image">
                <h3>${featAttrs.Title || featAttrs.title || 'Untitled'}</h3>
                <p class="meta">By ${featAttrs.Author || featAttrs.author || 'Unknown Author'} | ${featAttrs.PublishDate || featAttrs.publishDate || 'No date'}</p>
                <p>${extractRichText(featAttrs.JournalContent || featAttrs.content)}</p>
                <a class="read-more" href="./articlesPage.html?id=${feat.id}">Read more â†’</a>
              </article>
            `;
          });
        } else {
          featuredSection.innerHTML += "<p>No featured articles set. Mark some with 'featuredArticle' in Strapi.</p>";
        }

        // RECENT ARTICLES (next 3 non-featured)
        const displayRecent = recentArticles.slice(0, 3);
        if (displayRecent.length === 0) {
          recentSection.innerHTML += "<p>No recent articles available.</p>";
        } else {
          displayRecent.forEach((item) => {
            const itemAttrs = item.attributes || item;
            recentSection.innerHTML += `
              <article>
                <h4><a href="./articlesPage.html?id=${item.id}">${itemAttrs.Title || itemAttrs.title}</a></h4>
                <p class="meta">By ${itemAttrs.Author || itemAttrs.author} | ${itemAttrs.PublishDate || itemAttrs.publishDate}</p>
              </article>
            `;
          });
        }
      } catch (err) {
        console.error("Error loading articles:", err);
        document.getElementById("featured-article").innerHTML += 
          `<p style="color:red">Unable to fetch articles: ${err.message}. Check Strapi permissions.</p>`;
      }
    }

    async function loadScrolls() {
      try {
        // Load WelcomeScroll (Left)
        const welcomeRes = await fetch(`${API_BASE}/api/home-page-scrolls?populate=*&filters[ScrollName][$eq]=WelcomeScroll`);
        const welcomeJson = await welcomeRes.json();
        const welcomeData = welcomeJson.data && welcomeJson.data[0];
        if (welcomeData) {
          const leftScroll = document.querySelector('.left-scroll .scroll-paper p');
          if (leftScroll) {
            leftScroll.textContent = welcomeData.attributes?.ScrollText || welcomeData.ScrollText || 'Welcome message from Strapi!';
          }
        }
      } catch (err) {
        console.error("Error loading WelcomeScroll:", err);
      }

      try {
        // Load QuoteScroll (Right)
        const quoteRes = await fetch(`${API_BASE}/api/home-page-scrolls?populate=*&filters[ScrollName][$eq]=QuoteScroll`);
        const quoteJson = await quoteRes.json();
        const quoteData = quoteJson.data && quoteJson.data[0];
        if (quoteData) {
          const rightScroll = document.querySelector('.right-scroll .scroll-paper p');
          if (rightScroll) {
            rightScroll.textContent = quoteData.attributes?.ScrollText || quoteData.ScrollText || 'Quote from Strapi!';
          }
        }
      } catch (err) {
        console.error("Error loading QuoteScroll:", err);
      }
    }

    // Load everything when page loads
    window.addEventListener('load', () => {
      loadScrolls();
      loadArticles();
    });
  </script>
</body>
</html>
