<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SocWrites Journal</title>
  <link rel="stylesheet" href="./css/HomePage.css" />
  
</head>

<body>
  <header>
    <div class="container centered-header">
      <!-- Left Scroll -->
      <div class="scroll left-scroll">
        <div class="scroll-paper">
          <p>Loading welcome message...</p>
        </div>
      </div>

      <!-- FIXED LOGO PATH -->
      <img src="./images/logo/logo3.png" alt="SocWrites Logo" class="logo" />
      <h1>SocWrites Journal</h1>
      <p class="tagline">Where Research Meets Readers</p>
      <hr class="header-separator" />
      <nav>
        <ul>
          <li><a href="./index.html">Home</a></li>
          <li><a href="./Publications.html">Publications</a></li>
          <li><a href="./submit.html">Submit</a></li>
          <li><a href="./About_Us.html">About Us</a></li>
        </ul>
      </nav>
      
      <!-- Right Scroll -->
      <div class="scroll right-scroll">
        <div class="scroll-paper">
          <p>Loading inspirational quote...</p>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- FEATURED RESEARCH WITH SKELETON -->
    <section class="featured-article" id="featured-article">
      <h2>
        <!-- Featured Logo LEFT -->
        <svg class="logo-svg featured-logo" viewBox="0 0 48 48" width="36" height="36">
          <defs>
            <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#d4af37"/>
              <stop offset="50%" stop-color="#e1c275"/>
              <stop offset="100%" stop-color="#d4af37"/>
            </linearGradient>
          </defs>
          <circle cx="24" cy="24" r="22" fill="none" stroke="url(#goldGrad)" stroke-width="3" stroke-linecap="round"/>
          <polygon points="24,8 27,18 38,18 30,25 33,35 24,30 15,35 18,25 10,18 21,18" fill="url(#goldGrad)"/>
          <circle cx="36" cy="12" r="4" fill="#bca97e" opacity="0.8"/>
          <circle cx="37" cy="11" r="1.5" fill="white" opacity="0.6"/>
        </svg>
        Featured Research
      </h2>
      
      <!-- 3 Featured Skeletons -->
      <div class="skeletons-container">
        <div class="skeleton-card">
          <div class="skeleton skeleton-image"></div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-text-short"></div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-button"></div>
        </div>
        <div class="skeleton-card">
          <div class="skeleton skeleton-image"></div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-text-short"></div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-button"></div>
        </div>
        <div class="skeleton-card">
          <div class="skeleton skeleton-image"></div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-text-short"></div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-button"></div>
        </div>
      </div>
    </section>

    <!-- RECENT PUBLICATIONS WITH SKELETON -->
    <section class="article-list" id="recent-articles">
      <h2>
        <!-- Recent Logo LEFT -->
        <svg class="logo-svg recent-logo" viewBox="0 0 48 48" width="36" height="36">
          <defs>
            <linearGradient id="taupeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#bca97e"/>
              <stop offset="70%" stop-color="#a89b6e"/>
              <stop offset="100%" stop-color="#bca97e"/>
            </linearGradient>
          </defs>
          <path d="M12,12 Q16,8 24,8 Q32,8 36,12 L36,36 Q32,40 24,40 Q16,40 12,36 Z" 
                fill="url(#taupeGrad)" stroke="#f8f4ee" stroke-width="2" stroke-linejoin="round"/>
          <path d="M16,18 H32 M16,24 H32 M16,30 H28 M16,36 H24" stroke="#f8f4ee" stroke-width="1.5" stroke-linecap="round"/>
          <circle cx="38" cy="38" r="5" fill="#d4af37"/>
          <circle cx="38" cy="38" r="2" fill="white" opacity="0.4"/>
        </svg>
        Recent Publications
      </h2>
      
      <!-- 3 Recent Skeletons -->
      <div class="skeletons-container">
        <div class="skeleton-recent">
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-text-short"></div>
        </div>
        <div class="skeleton-recent">
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-text-short"></div>
        </div>
        <div class="skeleton-recent">
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-text-short"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- FIXED FOOTER SOCIAL ICONS -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-column">
        <h3>SocWrites</h3>
        <p>Where Research Meets Readers.</p>
        <p>Â© 2025 SocWrites. All Rights Reserved.</p>
      </div>
      <div class="footer-column">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="./index.html">Home</a></li>
          <li><a href="./Publications.html">Publications</a></li>
          <li><a href="./submit.html">Submit</a></li>
          <li><a href="./About_Us.html">About Us</a></li>
          <li><a href="mailto:support@socwrites.org">FAQ</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h4>Contact Us</h4>
        <p>Email: <a href="mailto:editor@socwrites.org">editor@socwrites.org</a></p>
        <p>Phone: +91 9650XXX101</p>
        <p>New Delhi, India</p>
        <div class="social-icons">
          <a href="https://www.facebook.com"><img src="./images/logo/Facebook.svg" alt="Facebook" /></a>
          <a href="https://www.instagram.com/thesocwrites?igsh=MjI5czdtcHlpaW5r"><img src="./images/logo/Instagram.svg" alt="Instagram" /></a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // PRODUCTION STRAPI URL
    const API_BASE = "https://glowing-star-d89f1652ea.strapiapp.com";

    async function loadArticles() {
      try {
        console.log('ðŸš€ Fetching articles...');
        
        // FIXED: Original working API call
        const res = await fetch(`${API_BASE}/api/articles?populate=*`);
        const json = await res.json();
        const articles = Array.isArray(json.data) ? json.data : [];

        console.log('ðŸ“Š Found articles:', articles.length);

        const featuredSection = document.getElementById("featured-article");
        const recentSection = document.getElementById("recent-articles");

        // Get skeleton containers
        const featuredContainer = featuredSection.querySelector('.skeletons-container');
        const recentContainer = recentSection.querySelector('.skeletons-container');

        if (articles.length === 0) {
          featuredContainer.innerHTML = '<p style="text-align:center;color:#666;">No articles found. Please add articles in Strapi admin.</p>';
          recentContainer.innerHTML = '<p style="text-align:center;color:#666;">No recent articles available.</p>';
          return;
        }

        // Filter featured articles
        const featuredArticles = articles.filter(article => 
          (article.attributes?.featuredArticle || article.featuredArticle) === true
        ).slice(0, 3);

        // Recent articles (newest first)
        const recentArticles = articles
          .filter(article => 
            (article.attributes?.featuredArticle || article.featuredArticle) !== true
          )
          .sort((a, b) => new Date(b.attributes?.PublishDate || b.PublishDate) - new Date(a.attributes?.PublishDate || a.PublishDate));

        // Helper functions
        const extractRichText = (richTextArray) => {
          if (!richTextArray || !Array.isArray(richTextArray)) return "No content available.";
          const content = richTextArray.children?.length ? richTextArray.children : richTextArray;
          return content
            ?.map(block => block.children?.map(child => child.text || "").join(" ") || "")
            .join(" ")
            .slice(0, 150) + "..." || "No content available.";
        };

        const getImageUrl = (article) => {
          let imgData = null;
          if (article.ArticleImage?.data?.attributes?.url) {
            imgData = article.ArticleImage.data.attributes;
          } else if (article.attributes?.ArticleImage?.data?.attributes?.url) {
            imgData = article.attributes.ArticleImage.data.attributes;
          }
          return imgData?.url ? API_BASE + imgData.url : "./images/logo/DefaultImage.svg";
        };

        // Replace Featured Skeletons
        featuredContainer.innerHTML = '';
        if (featuredArticles.length > 0) {
          featuredArticles.forEach((feat) => {
            const featAttrs = feat.attributes || feat;
            const img = getImageUrl(feat);
            featuredContainer.innerHTML += `
              <article>
                <img src="${img}" 
                     style="width:100%;max-height:240px;object-fit:cover;border-radius:10px;margin-bottom:10px;"
                     onerror="this.src='./images/logo/DefaultImage.svg';"
                     alt="Featured article image">
                <h3>${featAttrs.Title || featAttrs.title || 'Untitled'}</h3>
                <p class="meta">By ${featAttrs.Author || featAttrs.author || 'Unknown Author'} | ${featAttrs.PublishDate || featAttrs.publishDate || 'No date'}</p>
                <p>${extractRichText(featAttrs.JournalContent || featAttrs.content)}</p>
                <a class="read-more" href="./articlesPage.html?id=${feat.id || feat.documentId}">Read more â†’</a>
              </article>
            `;
          });
        } else {
          featuredContainer.innerHTML = '<p>No featured articles set. Mark some with \\'featuredArticle\\' in Strapi.</p>';
        }

        // Replace Recent Skeletons
        recentContainer.innerHTML = '';
        const displayRecent = recentArticles.slice(0, 3);
        if (displayRecent.length > 0) {
          displayRecent.forEach((item) => {
            const itemAttrs = item.attributes || item;
            recentContainer.innerHTML += `
              <article>
                <h4><a href="./articlesPage.html?id=${item.id}">${itemAttrs.Title || itemAttrs.title}</a></h4>
                <p class="meta">By ${itemAttrs.Author || itemAttrs.author} | ${itemAttrs.PublishDate || itemAttrs.publishDate}</p>
              </article>
            `;
          });
        } else {
          recentContainer.innerHTML = '<p>No recent articles available.</p>';
        }

      } catch (err) {
        console.error("âŒ Error loading articles:", err);
        document.querySelectorAll('.skeletons-container').forEach(container => {
          container.innerHTML = '<p style="color:red;">Unable to fetch articles. Check console & Strapi.</p>';
        });
      }
    }

    async function loadScrolls() {
      try {
        const res = await fetch(`${API_BASE}/api/home-page-scrolls?populate=*`);
        const json = await res.json();
        const scrollData = json.data?.[0];
        
        if (scrollData) {
          document.querySelector('.left-scroll .scroll-paper p').textContent = scrollData.WelcomeScroll;
          document.querySelector('.right-scroll .scroll-paper p').textContent = scrollData.QuoteScroll;
        }
      } catch (err) {
        console.error('Scrolls error:', err);
      }
    }

    window.addEventListener('load', () => {
      loadScrolls();
      loadArticles();
    });
  </script>
</body>
</html>
